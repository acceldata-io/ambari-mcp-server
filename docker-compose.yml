# ============================================================================
# Ambari MCP Server - Docker Compose Configuration
# ============================================================================
# 
# Usage:
#   1. Copy env.example to .env and configure your Ambari settings
#   2. Run: docker-compose up -d
#
# For MCP client integration, use the stdio mode directly:
#   docker run -i --rm --env-file .env ambari-mcp-server
#
# ============================================================================

services:
  ambari-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: ambari-mcp-server:latest
    container_name: ambari-mcp-server
    
    # MCP servers use stdio for communication
    # stdin_open and tty are needed for interactive mode
    stdin_open: true
    tty: true
    
    # Environment variables - override defaults from Dockerfile
    environment:
      # Ambari Server Configuration
      - AMBARI_BASE_URL=${AMBARI_BASE_URL:-http://localhost:8080/api/v1}
      - AMBARI_USERNAME=${AMBARI_USERNAME:-admin}
      - AMBARI_PASSWORD=${AMBARI_PASSWORD:-admin}
      - AMBARI_CLUSTER_NAME=${AMBARI_CLUSTER_NAME:-}
      
      # Request Configuration
      - TIMEOUT_MS=${TIMEOUT_MS:-30000}
      - INSECURE_SSL=${INSECURE_SSL:-0}
      
      # Debug Configuration
      - DEBUG=${DEBUG:-0}
      - ENV_DEBUG=${ENV_DEBUG:-0}
      
      # SSH Configuration (optional)
      - SSH_PRIVATE_KEY_PATH=${SSH_PRIVATE_KEY_PATH:-}
      - SSH_USERNAME=${SSH_USERNAME:-root}
      - SSH_PORT=${SSH_PORT:-22}
      - SSH_TIMEOUT=${SSH_TIMEOUT:-10000}
    
    # Mount SSH keys if needed (uncomment and adjust path)
    # volumes:
    #   - ~/.ssh/id_rsa:/app/ssh-keys/id_rsa:ro
    #   - /path/to/your/key.pem:/app/ssh-keys/key.pem:ro
    
    # Network settings - needed to reach Ambari server
    # Use 'host' network mode if Ambari is on localhost
    # network_mode: host
    
    # Or use default bridge network (Ambari must be reachable from container)
    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge
